uMon - primitive RRDtool-based host monitoring
==============================================


install dependencies:
# pkg_add rrdtool socat


configure httpd by adding this to httpd.conf:

# uMon - rrdtool-based monitoring
server "default" {
    listen on * port 8888
    location "/*" {
        fastcgi socket tcp 127.0.0.1 3333
    }
}

# rcctl reload httpd

The equivalent minimal config for Nginx is:

server {
    fastcgi_param  CONTENT_LENGTH     $content_length;
    fastcgi_param  CONTENT_TYPE       $content_type;
    fastcgi_param  DOCUMENT_URI       $document_uri;
    fastcgi_param  QUERY_STRING       $query_string;
    fastcgi_param  REQUEST_METHOD     $request_method;
    fastcgi_param  REQUEST_URI        $request_uri;

    listen 8888;
    location / {
        fastcgi_pass 127.0.0.1:3333;
    }
}


configure and enable snmpd:
# cp /etc/examples/snmpd.conf /etc/
# echo "listen on 127.0.0.1 snmpv2c" >> /etc/snmpd.conf
# echo "read-only community public" >> /etc/snmpd.conf
# rcctl enable snmpd
# rcctl start snmpd

Note: you are free (and encouraged) to use a different community string.
Please set SNMP_COMMUNITY in umon.conf accordingly if you do so.

verify that snmp queries work, output should be something similar to below:
$ snmp walk -v 2c -c public localhost ifDescr
ifDescr.1 = STRING: em0
ifDescr.2 = STRING: enc0
ifDescr.3 = STRING: lo0
ifDescr.4 = STRING: pflog0


configure database location and RRD settings by editing umon.conf
(should be fine as is)


configure the plugins by copying probes.conf.example to probes.conf
and editing it


run probes/sample.sh and observe that it creates RRD databases without errors:
$ probes/sample.sh
Creating directory for RRD files: db
Creating db/load.rrd
Creating db/cpu.rrd
Creating db/if-ens3.rrd
Creating db/if-lo.rrd

create a crontab entry for running sample.sh every minute:
$ crontab -l
...
*       *       *       *       *       /path/to/umon/probes/sample.sh 2>&1 >/dev/null


compile the fastcgi server:
make -C fcgi

run the fastcgi server:
fcgi/run.sh


configure the views you want to access by copying view.conf.example to
view.conf and editing it


navigate your browser to http://localhost:8888


## Notes on configuring SNMP

On OpenBSD: see above

On Linux running Net-SNMP:
- run download-mibs as root
- edit /etc/snmp/snmp.conf and uncomment the line saying 'mibs :'
- edit /etc/snmp/snmpd.conf and open up access to OIDs by adding a line such as:
  view   systemonly  included   .1.3.6
- sudo systemctl restart snmpd
